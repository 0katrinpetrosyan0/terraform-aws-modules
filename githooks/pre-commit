#!/bin/bash

for f in ./*modules*; do
    cd "$f"
    for i in `ls -d */`;do
        if ! git diff --quiet "${i}" 
        then
            echo "Start terraform docs";
            echo "Generating doc file: ${i}"; 
            terraform-docs markdown table --output-file README.md --output-mode inject "${i}";
            echo "End terraform docs";
        fi
    done
    cd ..
done
for y in $(find . -name '*.tf' -print)
    do
        if ! git diff --quiet "${y}" 
        then
            echo "Start terraform fmt";
            echo "Formatting the file: ${y}"; 
            terraform fmt -write=true "${y}"
            echo "End terraform fmt";
        fi
done