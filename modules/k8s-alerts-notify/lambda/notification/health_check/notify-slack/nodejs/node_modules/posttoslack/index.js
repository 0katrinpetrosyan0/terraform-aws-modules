//Takes a hostname, path, and msg to post to slack

var https = require("https");

exports.posttoslack = function(hostname, path, msg){
    return new Promise((resolve, reject) => {
        var options = {
            "method": "POST",
            "hostname": hostname,
            "path": path,
            "headers": {
                "Content-Type": "text/plain"
            }
        };
        var req = https.request(options, (res) => {
            resolve('Success');
        });
        req.on('error', (e) => {
            reject(e.message);
        });

        msg = JSON.parse(msg);

        // send the request
        var alarmName = msg.AlarmName || "";
        var alarmDescription = msg.AlarmDescription || "";
        var stateChangeTime = msg.StateChangeTime || "";
        var newStateReason = msg.NewStateReason || "";
        var region = msg.Region || "";

        var messageString = "Alarm name: " + alarmName +
            '\n Alarm description: ' + alarmDescription +
            '\n New state reason: ' + newStateReason +
            '\n State change time' + stateChangeTime +
            '\n Region: ' + region + '\n';

        req.write(JSON.stringify({ text: messageString }));
        // req.write(messageString);
        req.end();
    });
};
